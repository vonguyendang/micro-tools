<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ứng Dụng Tham Khảo Cổ Phiếu</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {

            font-family: 'Arial', sans-serif;
            background-color: #f4f7f6;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 5px;
            margin-top: 10%;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            flex-wrap: nowrap;
            text-align: center;
            width: 90%;
            max-width: 1000px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .tab.active {
            background-color: #2980b9;
            flex-grow: 1;
        }

        .container {
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 1000px;
            box-sizing: border-box;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        label {
            font-weight: bold;
            font-size: 16px;
            display: block;
            width: 100%;
        }

        input[type="text"],
        input[type="number"] {
            width: 100%;
            /* Đảm bảo input co giãn đúng */
            font-size: 16px;
            padding: 10px;
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            /* Đảm bảo padding không ảnh hưởng đến kích thước */
        }

        button {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            transition: background-color 0.3s;
            white-space: normal;
            /* Cho phép text xuống dòng */
            word-wrap: break-word;
            /* Ngắt từ khi dài */
            text-align: center;
            max-width: 100%;
            /* Đảm bảo button không bị tràn khỏi container */
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        button:hover {
            background-color: #16689e;
        }

        .result {
            margin-top: 30px;
            font-size: 14px;
        }

        .inline {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .divider {
            font-size: 18px;
            font-weight: bold;
        }

        .inline div {
            width: 48%;
        }

        #resultGDKHQ {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            margin-top: 25px;
            padding: 20px;
            border-radius: 8px;
            color: #4caf50;
            background-color: #e8f5e9;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transform: scale(0.9);
            transition: all 0.3s ease;
        }

        #resultGDKHQ.show {
            opacity: 1;
            transform: scale(1);
        }

        /* Responsive cho màn hình nhỏ hơn 768px (mobile) */
        /* @media (max-width: 768px) {
            .container {
                width: 95%;
                padding: 20px;
            }
            
            .inline {
                flex-direction: column;
            }
        
            .inline div {
                width: 100%;
            }
        
            .tab {
                flex: 1;
                text-align: center;
                border-radius: 5px;
            }
            
            h1 {
                font-size: 22px;
            }
        
            input[type="text"], input[type="number"] {
                width: 100%;
            }
        
            button {
                width: 100%;
            }
        }
            */

        /* Responsive cho màn hình rất nhỏ (dưới 480px) */
        @media (max-width: 360px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 15px;
            }

            h1 {
                font-size: 20px;
            }

            .divider {
                display: none;
            }

            button {
                font-size: 14px;
                padding: 8px;
            }

            input[type="text"],
            input[type="number"] {
                font-size: 16px;
            }
        }
    </style>
</head>

<body>

    <div class="tabs">
        <button class="tab active" onclick="showTab('tab1')">ĐỊNH GIÁ CỔ PHIẾU</button>
        <button class="tab" onclick="showTab('tab2')">TÍNH GIÁ CỔ PHIẾU NGÀY GDKHQ</button>
    </div>

    <div id="tab1" class="container">
        <h1><i class="fas fa-chart-line"></i> Định Giá Cổ Phiếu</h1>
        <label for="stockCode">Mã cổ phiếu:</label>
        <input type="text" id="stockCode" placeholder="Nhập mã cổ phiếu...">
        <button onclick="fetchStockData()"><i class="fas fa-calculator"></i> Tính toán</button>

        <div class="result" id="resultValuation"></div>
    </div>

    <div id="tab2" class="container" style="display:none;">
        <h1><i class="fas fa-chart-line"></i> Tính Giá Cổ Phiếu Ngày GDKHQ</h1>
        <label for="P">Giá cổ phiếu (đóng cửa) liền trước ngày GDKHQ:</label>
        <input type="number" id="P" step="0.01">

        <label for="Pa">Giá cổ phiếu phát hành thêm:</label>
        <input type="number" id="Pa" step="0.01">

        <label for="sohuuPHT">Tỷ lệ cổ phiếu phát hành thêm:</label>
        <div class="inline">
            <div>
                <input type="number" id="sohuuPHT" step="1" placeholder="Sở hữu">
            </div>
            <span class="divider"><br>:</span>
            <div>
                <input type="number" id="quyenPHT" step="1" placeholder="Quyền mua">
            </div>
        </div>

        <label for="sohuuTM">Tỷ lệ cổ tức bằng tiền mặt:</label>
        <div class="inline">
            <div>
                <input type="number" id="sohuuTM" step="1" placeholder="Sở hữu">
            </div>
            <span class="divider"><br>:</span>
            <div>
                <input type="number" id="quyenTM" step="0.01" placeholder="Số tiền">
            </div>
        </div>

        <label for="sohuuCP">Tỷ lệ cổ tức bằng cổ phiếu:</label>
        <div class="inline">
            <div>
                <input type="number" id="sohuuCP" step="1" placeholder="Sở hữu">
            </div>
            <span class="divider"><br>:</span>
            <div>
                <input type="number" id="quyenCP" step="1" placeholder="Số cổ phiếu">
            </div>
        </div>

        <button onclick="calculatePrice()"><i class="fas fa-calculator"></i> Tính Toán</button>

        <div class="result" id="resultGDKHQ"></div>
    </div>

    <script>
        function showTab(tabId) {
            document.getElementById('tab1').style.display = tabId === 'tab1' ? 'block' : 'none';
            document.getElementById('tab2').style.display = tabId === 'tab2' ? 'block' : 'none';

            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            if (tabId === 'tab1') {
                tabs[0].classList.add('active');
            } else {
                tabs[1].classList.add('active');
            }
        }

        async function fetchStockData() {
            const stockCode = document.getElementById('stockCode').value.toUpperCase();
            const apiKey = 'Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSIsImtpZCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSJ9.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4iLCJhdWQiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4vcmVzb3VyY2VzIiwiZXhwIjoyMDA5MTc4MDczLCJuYmYiOjE3MDkxNzgwNzMsImNsaWVudF9pZCI6ImZpcmVhbnQudHJhZGVzdGF0aW9uIiwic2NvcGUiOlsib3BlbmlkIiwicHJvZmlsZSIsInJvbGVzIiwiZW1haWwiLCJhY2NvdW50cy1yZWFkIiwiYWNjb3VudHMtd3JpdGUiLCJvcmRlcnMtcmVhZCIsIm9yZGVycy13cml0ZSIsImNvbXBhbmllcy1yZWFkIiwiaW5kaXZpZHVhbHMtcmVhZCIsImZpbmFuY2UtcmVhZCIsInBvc3RzLXdyaXRlIiwicG9zdHMtcmVhZCIsInN5bWJvbHMtcmVhZCIsInVzZXItZGF0YS1yZWFkIiwidXNlci1kYXRhLXdyaXRlIiwidXNlcnMtcmVhZCIsInNlYXJjaCIsImFjYWRlbXktcmVhZCIsImFjYWRlbXktd3JpdGUiLCJibG9nLXJlYWQiLCJpbnZlc3RvcGVkaWEtcmVhZCJdLCJzdWIiOiIzMWYzYzU5Ny1jYjZlLTQzYWEtYmRlZS01NjkyYjM3YWNiM2EiLCJhdXRoX3RpbWUiOjE3MDkxNzgwNzMsImlkcCI6Imlkc3J2IiwibmFtZSI6InZvZGFuZzI3MDJAZ21haWwuY29tIiwic2VjdXJpdHlfc3RhbXAiOiJlNjA5NTEzYy05ZDFmLTQ4NGUtOTAyNi01MTA0ZDVlNmYzNTMiLCJqdGkiOiIwNzc0MDRiNmE1ZmM3MjQ4ZmMyMmNlYmEzYjUzYjlhZCIsImFtciI6WyJwYXNzd29yZCJdfQ.yhyKMefOxXhxIFTD9YCAUnQYqGAnA7-m89g-EWX3B3N51m614d2uj3IhEMH6kl8W-zhgdWu1yfIY7PgiwIUqAKL4M-LG93roNzTN0F0tk_WCFbrpxyc3Z4Cv1uTi4A10EGCkqwnZ3sZV8ValCmzfxmDvXDoQRFuy91nznmiUFEg_YVnukVsZyASetLh6-_jYC-FsuW9ZCLAXo4QNkr6_DsJKbIywZkkofn7IsfWFMDBoa5dEiPyxfG8zMq3F3pydh_fKPjaz-oUWmewjIRwm0ohfNwvTJqs4jU0Pz4t4QmFYvRj_yrILxTc_59ewZvKb_fvuE8q3l1E7dXvIb7SYIg'; // Thay thế bằng API key của bạn
            const resultDiv = document.getElementById('resultValuation');
            resultDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Đang tính toán...';
            try {

                const [response1, response2, response3, response4, response5] = await Promise.all([
                    fetch(`https://restv2.fireant.vn/symbols/${stockCode}/fundamental`, {
                        headers: {
                            'accept': 'application/json',
                            'authorization': apiKey
                        }
                    }),
                    fetch(`https://restv2.fireant.vn/symbols/${stockCode}/financial-data?type=Q&count=4`, {
                        headers: {
                            'accept': 'application/json',
                            'authorization': apiKey
                        }
                    }),
                    fetch(`https://restv2.fireant.vn/symbols/${stockCode}/financial-data?type=Y&count=5`, {
                        headers: {
                            'accept': 'application/json',
                            'authorization': apiKey
                        }
                    }),
                    fetch('https://sbcharts.investing.com/bond_charts/bonds_chart_72.json'),

                    fetch(`https://restv2.fireant.vn/symbols/${stockCode}/profile`, {
                        headers: {
                            'accept': 'application/json',
                            'authorization': apiKey
                        }
                    }),
                ])

                if (!response1.ok || !response2.ok || !response3.ok || !response4.ok || !response5.ok) {
                    throw new Error('Lỗi khi lấy dữ liệu, vui lòng thử lại.');
                }

                const [stockData, financialDataQuarter, financialDataYear, bonds, stockProfile] = await Promise.all([
                    response1.json(),
                    response2.json(),
                    response3.json(),
                    response4.json(),
                    response5.json()
                ]);

                // Lấy thông tin cổ phiếu
                const stockExchange = stockProfile.exchange;

                const stockName = stockProfile.companyName;

                const marketPrice = stockData.marketCap / stockData.sharesOutstanding;

                const betaStock = stockData.beta;

                const floatingShareRatio = stockData.freeShares / stockData.sharesOutstanding;

                // Lấy thông tin tài chính 4 quý


                // Tính toán các chỉ số trung bình
                let totalEPS = 0, totalPE = 0, totalPB = 0, totalPS = 0, totalROA = 0, totalROE = 0, totalSalePerShare = 0, totalBookValuePerShare = 0, totalTangibleBookValuePerShare = 0;

                financialDataQuarter.forEach(data => {
                    totalEPS += data.financialValues.BasicEPS;
                    totalPE += data.financialValues.PE;
                    totalPB += data.financialValues.PB;
                    totalPS += data.financialValues.PS
                    totalROA += data.financialValues.ROA;
                    totalROE += data.financialValues.ROE;
                    totalSalePerShare += data.financialValues.SalePerShare;
                    totalBookValuePerShare += data.financialValues.BookValuePerShare;
                    totalTangibleBookValuePerShare += data.financialValues.TangibleBookValuePerShare;

                });

                const avgEPS = totalEPS / financialDataQuarter.length;
                const avgPE = totalPE / financialDataQuarter.length;
                const avgPB = totalPB / financialDataQuarter.length;
                const avgPS = totalPS / financialDataQuarter.length;
                const avgROA = totalROA / financialDataQuarter.length;
                const avgROE = totalROE / financialDataQuarter.length;
                const avgSalePerShare = totalSalePerShare / financialDataQuarter.length;
                const avgBookValuePerShare = totalBookValuePerShare / financialDataQuarter.length;
                const avgTangibleBookValuePerShare = totalTangibleBookValuePerShare / financialDataQuarter.length;


                const price1 = avgPE * avgEPS;
                const price2 = avgPS * avgSalePerShare;


                const g = Math.pow((financialDataYear[0].financialValues.BasicEPS / financialDataYear[4].financialValues.BasicEPS), 1 / 5) - 1
                //Công thức điều chỉnh của Benjamin Graham: (V = EPS × (8.5 +s 2g) × (4.4 / y))
                //V = EPS × (8.5 + 2g)
                // V = EPS × (8.5 + 2g) × (4.4 / y)
                // V = √(22.5 × EPS × BVPS)


                //Lãi suất trái phiếu chính phủ kỳ hạn 10 năm + 0.5%.

                const y10 = bonds.current[5][1];
                //ưu tiên 50%
                const price3 = avgEPS * (8.5 + 2 * g) * (4.4 / (y10 + 0.5));
                //ưu tiên 30%
                const price4 = avgEPS * (8.5 + 2 * g);
                //ưu tiên 20%
                const price5 = Math.sqrt(22.5 * avgEPS * avgBookValuePerShare);



                //Định giá trung bình

                const avgPrice = (price1 + price1 + price3 * 0.5 + price4 * 0.3 + price5 * 0.2) / 3


                //Nhận định
                let marketPriceComment = `Sàn ${stockExchange} | ${stockName}`;


                let avgEPSComment = '';
                if (avgEPS >= 3000) {
                    avgEPSComment = `Cực tốt, khả năng duy trì ổn định hoặc tăng trưởng qua các kỳ. Cho thấy công ty có tiềm năng lớn và khả năng sinh lời mạnh mẽ.`;
                } else if (avgEPS >= 1500 && avgEPS < 3000) {
                    avgEPSComment = `Tốt, cho thấy công ty đang hoạt động hiệu quả và sử dụng vốn hợp lý để tạo ra lợi nhuận cho cổ đông.`;
                } else if (avgEPS >= 500 && avgEPS < 1500) {
                    avgEPSComment = `Trung bình, chưa thật sự ổn định, cần xem xét thêm các yếu tố như ngành nghề kinh doanh, giai đoạn phát triển của công ty, và kế hoạch tái đầu tư.`;
                } else {
                    avgEPSComment = `Cực xấu, cho thấy công ty đang gặp khó khăn trong việc tạo ra lợi nhuận cho cổ đông hoặc sử dụng vốn không hiệu quả.`;
                }

                let avgPEComment = '';
                if (avgPE < 10) {
                    avgPEComment = `Thấp, cổ phiếu được định giá thấp hơn giá trị thực, có thể là cơ hội đầu tư.`;
                } else if (avgPE >= 10 && avgPE < 20) {
                    avgPEComment = `Trung bình, là mức hợp lý đối với hầu hết các ngành ổn định và không có tăng trưởng đột biến.`;
                } else if (avgPE >= 20 && avgPE < 30) {
                    avgPEComment = `Cao, thường phản ánh kỳ vọng tăng trưởng cao trong tương lai hoặc thị trường đang định giá quá cao`;
                } else {
                    avgPEComment = `Rất cao, cổ phiếu được định giá cao hơn giá trị thực, cần cẩn trọng trước khi đầu tư.`;
                }

                let avgPBComment = '';
                if (avgPB < 1) {
                    avgPBComment = `Thấp, cổ phiếu được định giá thấp hơn giá trị sổ sách, có thể là cơ hội đầu tư.`;
                } else if (avgPB >= 1 && avgPB < 2) {
                    avgPBComment = `Trung bình, là mức hợp lý đối với hầu hết các ngành ổn định và không có tăng trưởng đột biến.`;
                } else if (avgPB >= 2 && avgPB < 3) {
                    avgPBComment = `Cao, thường phản ánh kỳ vọng tăng trưởng cao trong tương lai hoặc thị trường đang định giá quá cao.`;
                } else {
                    avgPBComment = `Rất cao, cổ phiếu được định giá quá cao so với giá trị sổ sách, cần cẩn trọng trước khi đầu tư.`;
                }

                let avgPSComment = '';
                if (avgPS < 1) {
                    avgPSComment = `Thấp, cổ phiếu được định giá thấp hơn doanh thu, có thể là cơ hội đầu tư.`;
                } else if (avgPS >= 1 && avgPS < 2) {
                    avgPSComment = `Trung bình, là mức hợp lý đối với hầu hết các ngành ổn định và không có tăng trưởng đột biến.`;
                } else if (avgPS >= 2 && avgPS < 3) {
                    avgPSComment = `Cao, thường phản ánh kỳ vọng tăng trưởng cao trong tương lai hoặc thị trường đang định giá quá cao.`;
                } else {
                    avgPSComment = `Rất cao, cổ phiếu được định giá quá cao so với doanh thu, cần cẩn trọng trước khi đầu tư.`;
                }

                let betaStockComment = '';
                if (betaStock === 1) {
                    betaStockComment = "Chứng khoán có mức biến động tương đương với thị trường.";
                } else if (betaStock > 0 && betaStock < 1) {
                    betaStockComment = "Chứng khoán ít biến động hơn thị trường, rủi ro thấp hơn.";
                } else if (betaStock > 1) {
                    betaStockComment = "Chứng khoán biến động mạnh hơn thị trường, tiềm năng sinh lời cao nhưng đi kèm rủi ro lớn.";
                } else if (betaStock === 0) {
                    betaStockComment = "Chứng khoán không liên quan đến sự biến động của thị trường.";
                } else {
                    betaStockComment = "Chứng khoán di chuyển ngược chiều với thị trường.";
                }


                let floatingShareRatioComment = '';

                if (floatingShareRatio < 0.2) {
                    floatingShareRatioComment = "Cổ phiếu có tỷ lệ thả nổi thấp, cung hạn chế, thanh khoản không ổn định, giá biến động cao.";
                } else if (floatingShareRatio >= 0.2 && floatingShareRatio < 0.6) {
                    floatingShareRatioComment = "Cổ phiếu có tỷ lệ thả nổi trung bình, cân bằng cung - cầu, thanh khoản vừa phải, không gây biến động quá lớn.";
                } else {
                    floatingShareRatioComment = "Cổ phiếu có tỷ lệ thả nổi cao, cung dồi dào, khả năng hấp thụ lớn, ít bị thao túng, giá cổ phiếu phản ánh sát thực trạng thị trường.";
                }

                let avgROAComment = '';
                if (avgROA >= 0.1) {
                    avgROAComment = `Cực tốt, công ty có khả năng sinh lời cao, hiệu quả lợi nhuận tốt từ vốn chủ sở hữu.`;
                } else if (avgROA >= 0.05 && avgROA < 0.1) {
                    avgROAComment = `Tốt, công ty có khả năng sinh lời ổn định từ vốn chủ sở hữu, nhưng chưa vượt trội.`;
                } else if (avgROA >= 0 && avgROA < 0.05) {
                    avgROAComment = `Trung bình, công ty chưa sử dụng vốn hiệu quả để sinh lời.`;
                } else {
                    avgROAComment = `Xấu, công ty không sinh lời từ vốn chủ sở hữu.`;
                }

                let avgROEComment = '';
                if (avgROE >= 0.15) {
                    avgROEComment = `Cực tốt, công ty có khả năng sinh lời cao từ tổng tài sản.`;
                } else if (avgROE >= 0.10 && avgROE < 0.15) {
                    avgROEComment = `Tốt, công ty có khả năng sinh lời từ tổng tài sản, chưa vượt trội.`;
                } else if (avgROE >= 0 && avgROE < 0.10) {
                    avgROEComment = `Trung bình, công ty chưa sử dụng vốn hiệu quả để sinh lời.`;
                } else {
                    avgROEComment = `Xấu, công ty không sinh lời từ tổng tài sản.`;
                }
                let avgSalePerShareComment = '';

                let avgBookValuePerShareComment = '';

                if (avgBookValuePerShare > marketPrice) {
                    avgBookValuePerShareComment = `Cổ phiếu có giá trị sổ sách cao hơn thị giá ${(avgBookValuePerShare/marketPrice - 1).toFixed(4)*100}%, có thể là cơ hội đầu tư.`;
                } else if (avgBookValuePerShare < marketPrice) {
                    avgBookValuePerShareComment = `Cổ phiếu có giá trị sổ sách thấp hơn thị giá ${(1 - avgBookValuePerShare/marketPrice).toFixed(4)*100}%, cần cẩn trọng trước khi đầu tư.`;
                } else {
                    avgBookValuePerShareComment = 'Cổ phiếu có thị giá tương đương với giá trị sổ sách.';
                }

                let avgTangibleBookValuePerShareComment = '';

                let price1Comment = '';
                if (price1 < 0) {
                    price1Comment = 'Cổ phiếu quá xấu không nên đầu tư.';
                }

                let price2Comment = '';
                if (price2 < 0) {
                    price2Comment = 'Cổ phiếu quá xấu không nên đầu tư.';
                }

                let price3Comment = '';
                if (isNaN(price3)) {
                    price3Comment = 'Cổ phiếu quá xấu không nên đầu tư.';
                } else if (price3 < 0) {
                    price3Comment = 'Cổ phiếu quá xấu không nên đầu tư.';
                }

                let price4Comment = '';
                if (isNaN(price4)) {
                    price4Comment = 'Cổ phiếu quá xấu không thể đưa ra định giá, không nên đầu tư.';
                } else if (price4 < 0) {
                    price4Comment = 'Cổ phiếu quá xấu không nên đầu tư.';
                }

                let price5Comment = '';
                if (isNaN(price5)) {
                    price5Comment = 'Cổ phiếu quá xấu không thể đưa ra định giá, không nên đầu tư.';
                } else if (price5 < 0) {
                    price5Comment = 'Cổ phiếu quá xấu không nên đầu tư.';
                }
                
                let avgPriceComment = '';
                
                if (avgPrice > marketPrice) {
                    avgPriceComment = `Cổ phiếu được định giá cao hơn giá thị trường ${100*(avgPrice/marketPrice - 1).toFixed(2)}%, có thể là cơ hội đầu tư.`;
                } else if (avgPrice < marketPrice) {
                    avgPriceComment = `Cổ phiếu được định giá thấp hơn giá thị trường ${100*(1 -avgPrice/marketPrice).toFixed(2)}%, cần cẩn trọng trước khi đầu tư.`;
                } else if (isNaN(avgPrice)) {
                    avgPriceComment = 'Cổ phiếu quá xấu không thể đưa ra định giá, không nên đầu tư.';
                }else {
                    avgPriceComment = 'Cổ phiếu được định giá tương đương với giá thị trường.';
                }


                // resultDiv.innerHTML = `
                //                 <p><i class="fas fa-dollar-sign icon"></i> Giá thị trường: <strong>${marketPrice.toFixed(2)} VNĐ</strong></p>
                //                 <p><i class="fas fa-chart-bar icon"></i> Lợi nhuận trên mỗi cổ phiếu (EPS trung bình 4 quý): <strong>${avgEPS.toFixed(2)} VNĐ</strong></p>
                //                 <p><i class="fas fa-chart-bar icon"></i> Tỷ lệ giá trên lợi nhuận (PE trung bình 4 quý): <strong>${avgPE.toFixed(2)} lần</strong></p>
                //                 <p><i class="fas fa-chart-bar icon"></i> Tỷ lệ giá trên giá trị sổ sách (PB trung bình 4 quý): <strong>${avgPB.toFixed(2)} lần</strong></p>
                //                 <p><i class="fas fa-chart-bar icon"></i> Tỷ lệ giá trên doanh thu (PS trung bình 4 quý: <strong>${avgPS.toFixed(2)} lần</strong></p>
                //                 <p><i class="fas fa-chart-bar icon"></i> Hệ số rủi ro thị trường (Beta): <strong>${betaStock.toFixed(2)} lần</strong></p>
                //                 <p><i class="fas fa-chart-bar icon"></i> Tỉ lệ cổ phiếu thả nổi (FSR): <strong>${(floatingShareRatio * 100).toFixed(2)} %</strong></p>
                //                 <p><i class="fas fa-chart-bar icon"></i> Tỷ suất lợi nhuận trên vốn chủ sở hữu(4 quý): <strong>${(avgROA * 100).toFixed(2)} %</strong></p>
                //                 <p><i class="fas fa-chart-bar icon"></i> Tỷ suất lợi nhuận trên tổng tài sản (4 quý): <strong>${(avgROE * 100).toFixed(2)} % </strong></p>
                //                 <p><i class="fas fa-chart-bar icon"></i> Doanh thu trên mỗi cổ phiếu (SPS trung bình 4 quý): <strong>${avgSalePerShare.toFixed(2)} VNĐ</strong></p>
                //                 <p><i class="fas fa-chart-bar icon"></i> Giá trị sổ sách trên mỗi cổ phiếu (BVPS trung bình 4 quý): <strong>${avgBookValuePerShare.toFixed(2)} VNĐ</strong></p>
                //                 <p><i class="fas fa-chart-bar icon"></i> Giá trị sổ sách hữu hình trên mỗi cổ phiếu (TBVPS trung bình 4 quý): <strong>${avgTangibleBookValuePerShare.toFixed(2)} VNĐ</strong></p>
                //                 <p><i class="fas fa-coins icon"></i> Định giá cổ phiếu theo P/E và EPS <strong>${price1.toFixed(2)} VNĐ</strong></p>
                //                 <p><i class="fas fa-coins icon"></i> Định giá cổ phiếu theo P/S và SPS:  <strong>${price2.toFixed(2)} VNĐ</strong></p>
                //                 <p><i class="fas fa-coins icon"></i> Định giá cổ phiếu theo Braham 1: <strong>${price3.toFixed(2)} VNĐ</strong></p>
                //                 <p><i class="fas fa-coins icon"></i> Định giá cổ phiếu theo Braham 2: <strong>${price4.toFixed(2)} VNĐ</strong></p>
                //                 <p><i class="fas fa-coins icon"></i> Định giá cổ phiếu theo Braham 3: <strong>${price5.toFixed(2)} VNĐ</strong></p>
                //                 <p><i class="fas fa-coins icon"></i> Định giá trung bình: <strong>${avgPrice.toFixed(2)} VNĐ</strong></p>
                //             `;
                resultDiv.innerHTML = `
                                        <style>
                                            table {
                                                width: 100%;
                                                border-collapse: collapse;
                                                font-size: 14px;
                                            }

                                            table, th, td {
                                                border: 1px solid #ddd;
                                            }

                                            th, td {
                                                padding: 8px;
                                                text-align: left;
                                            }

                                            th {
                                                background-color: #f4f4f4;
                                            }

                                            .value {
                                                text-align: right;
                                                white-space: nowrap;
                                            }
                                            th.center {
                                                text-align: center;
                                            }
                                        </style>
                                        
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th class="center">Chỉ số</th>
                                                    <th class="center">Giá trị</th>
                                                    <th class="center">Nhận định</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td><i class="fas fa-dollar-sign icon"></i> Giá thị trường</td>
                                                    <td class="value">${marketPrice.toFixed(0)} đ</td>
                                                    <td>${marketPriceComment}</td>
                                                </tr>
                                                <tr>
                                                    <td><i class="fas fa-chart-bar icon"></i> Lợi nhuận trên mỗi cổ phiếu (EPS trung bình 4 quý)</td>
                                                    <td class="value">${avgEPS.toFixed(0)} đ</td>
                                                    <td>${avgEPSComment}</td>
                                                </tr>
                                                <tr>
                                                    <td><i class="fas fa-chart-bar icon"></i> Tỷ lệ giá trên lợi nhuận (PE trung bình 4 quý)</td>
                                                    <td class="value">${avgPE.toFixed(2)} lần</td>
                                                    <td>${avgPEComment}</td>
                                                </tr>
                                                <tr>
                                                    <td><i class="fas fa-chart-bar icon"></i> Tỷ lệ giá trên giá trị sổ sách (PB trung bình 4 quý)</td>
                                                    <td class="value">${avgPB.toFixed(2)} lần</td>
                                                    <td>${avgPBComment}</td>
                                                </tr>
                                                <tr>
                                                    <td><i class="fas fa-chart-bar icon"></i> Tỷ lệ giá trên doanh thu (PS trung bình 4 quý)</td>
                                                    <td class="value">${avgPS.toFixed(2)} lần</td>
                                                    <td>${avgPSComment}</td>
                                                </tr>
                                                <tr>
                                                    <td><i class="fas fa-chart-bar icon"></i> Hệ số rủi ro thị trường (Beta)</td>
                                                    <td class="value">${betaStock.toFixed(2)} lần</td>
                                                    <td>${betaStockComment}</td>
                                                </tr>
                                                <tr>
                                                    <td><i class="fas fa-chart-bar icon"></i> Tỉ lệ cổ phiếu thả nổi (FSR)</td>
                                                    <td class="value">${(floatingShareRatio * 100).toFixed(2)} %</td>
                                                    <td>${floatingShareRatioComment}</td>
                                                </tr>
                                                <tr>
                                                    <td><i class="fas fa-chart-bar icon"></i> Tỷ suất lợi nhuận trên vốn chủ sở hữu (4 quý)</td>
                                                    <td class="value">${(avgROA * 100).toFixed(2)} %</td>
                                                    <td>${avgROAComment}</td>
                                                </tr>
                                                <tr>
                                                    <td><i class="fas fa-chart-bar icon"></i> Tỷ suất lợi nhuận trên tổng tài sản (4 quý)</td>
                                                    <td class="value">${(avgROE * 100).toFixed(2)} %</td>
                                                    <td>${avgROEComment}</td>
                                                </tr>
                                                <tr>
                                                    <td><i class="fas fa-chart-bar icon"></i> Doanh thu trên mỗi cổ phiếu (SPS trung bình 4 quý)</td>
                                                    <td class="value">${avgSalePerShare.toFixed(0)} đ</td>
                                                    <td>${avgSalePerShareComment}</td>
                                                </tr>
                                                <tr>
                                                    <td><i class="fas fa-chart-bar icon"></i> Giá trị sổ sách trên mỗi cổ phiếu (BVPS trung bình 4 quý)</td>
                                                    <td class="value">${avgBookValuePerShare.toFixed(0)} đ</td>
                                                    <td>${avgBookValuePerShareComment}</td>
                                                </tr>
                                                <tr>
                                                    <td><i class="fas fa-chart-bar icon"></i> Giá trị sổ sách hữu hình trên mỗi cổ phiếu (TBVPS trung bình 4 quý)</td>
                                                    <td class="value">${avgTangibleBookValuePerShare.toFixed(0)} đ</td>
                                                    <td>${avgTangibleBookValuePerShareComment}</td>
                                                </tr>
                                                <tr>
                                                    <td><i class="fas fa-coins icon"></i> Định giá cổ phiếu theo P/E và EPS</td>
                                                    <td class="value">${price1.toFixed(0)} đ</td>
                                                    <td>${price1Comment}</td>
                                                </tr>
                                                <tr>
                                                    <td><i class="fas fa-coins icon"></i> Định giá cổ phiếu theo P/S và SPS</td>
                                                    <td class="value">${price2.toFixed(0)} đ</td>
                                                    <td>${price2Comment}</td>
                                                </tr>
                                                <tr>
                                                    <td><i class="fas fa-coins icon"></i> Định giá cổ phiếu theo Braham 1</td>
                                                    <td class="value">${price3.toFixed(0)} đ</td>
                                                    <td>${price3Comment}</td>
                                                </tr>
                                                <tr>
                                                    <td><i class="fas fa-coins icon"></i> Định giá cổ phiếu theo Braham 2</td>
                                                    <td class="value">${price4.toFixed(0)} đ</td>
                                                    <td>${price4Comment}</td>
                                                </tr>
                                                <tr>
                                                    <td><i class="fas fa-coins icon"></i> Định giá cổ phiếu theo Braham 3</td>
                                                    <td class="value">${price5.toFixed(0)} đ</td>
                                                    <td>${price5Comment}</td>
                                                </tr>
                                                <tr>
                                                    <td><i class="fas fa-coins icon"></i> Định giá trung bình</td>
                                                    <td class="value">${avgPrice.toFixed(0)} đ</td>
                                                    <td>${avgPriceComment}</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    `;

            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;"><i class="fas fa-exclamation-circle"></i> ${error.message}</p>`;
            }
        }

        function calculatePrice() {
            let P = parseFloat(document.getElementById('P').value) || 0;
            let Pa = parseFloat(document.getElementById('Pa').value) || 0;
            let sohuuPHT = parseFloat(document.getElementById('sohuuPHT').value) || 0;
            let quyenPHT = parseFloat(document.getElementById('quyenPHT').value) || 0;
            let sohuuTM = parseFloat(document.getElementById('sohuuTM').value) || 0;
            let quyenTM = parseFloat(document.getElementById('quyenTM').value) || 0;
            let sohuuCP = parseFloat(document.getElementById('sohuuCP').value) || 0;
            let quyenCP = parseFloat(document.getElementById('quyenCP').value) || 0;

            let a = sohuuPHT > 0 && quyenPHT > 0 ? quyenPHT / sohuuPHT : 0;
            let C = sohuuTM > 0 && quyenTM > 0 ? quyenTM / sohuuTM : 0;
            let B = sohuuCP > 0 && quyenCP > 0 ? quyenCP / sohuuCP : 0;
            let P_prime = (P + (Pa * a) - C) / (1 + a + B);

            let resultDiv = document.getElementById('resultGDKHQ');
            resultDiv.innerText = `Giá cổ phiếu vào ngày GDKHQ: ${P_prime.toFixed(2)} VND`;
            resultDiv.classList.add('show');
        }
    </script>

</body>

</html>