<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Review</title>
    <link rel="shortcut icon" href="favicon_io/favicon-32x32.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="tabs-container">
        <div class="tabs">
            <button class="tab active" onclick="showTab('tab1')"><i class="fas fa-chart-pie"></i> ĐỊNH GIÁ CỔ PHIẾU</button>
            <button class="tab" onclick="showTab('tab2')"><i class="fas fa-calendar-alt"></i> GIÁ NGÀY GDKHQ</button>
            <button class="tab" onclick="showTab('tab7')"><i class="fas fa-hands-helping"></i> HỖ TRỢ NĐT</button>
            <button class="tab" onclick="showTab('tab3')"><i class="fas fa-list-alt"></i> NIÊM YẾT MỚI</button>
            <button class="tab" onclick="showTab('tab4')"><i class="fas fa-bullhorn"></i> LỊCH SỰ KIỆN</button>
            <button class="tab" onclick="showTab('tab5')"><i class="fas fa-paper-plane"></i> PHÁT HÀNH</button>
            <button class="tab" onclick="showTab('tab6')"><i class="fas fa-th-large"></i> PTKT</button>
        </div>
    </div>


    <div id="tab1" class="container active-container">
        <header>
            <h1><i class="fas fa-search-dollar"></i> Định Giá Cổ Phiếu</h1>
        </header>
        <main>
            <div class="input-group">
                <label for="stockCode"><i class="fas fa-tag"></i> Mã cổ phiếu:</label>
                <input type="text" id="stockCode" placeholder="Nhập mã cổ phiếu (VD: HPG, FPT)...">
            </div>
            <div class="button-container main-actions">
                 <button class="action-button calculate-button" onclick="fetchStockData()">
                    <i class="fas fa-calculator"></i> Tính toán Định giá
                 </button>
            </div>
            <div class="result" id="resultValuation">
                 <p class="placeholder-text">Nhập mã cổ phiếu và nhấn "Tính toán" để xem kết quả định giá chi tiết.</p>
            </div>
         </main>
    </div>

    <div id="tab2" class="container">
        <header>
            <h1><i class="fas fa-adjust"></i> Tính Giá Điều Chỉnh Ngày GDKHQ</h1>
        </header>
        <main>
            <div class="input-group">
                <label for="preGDKHQInput"><i class="fas fa-file-invoice-dollar"></i> Giá trước GDKHQ hoặc Mã CK:</label>
                <input type="text" id="preGDKHQInput" placeholder="Nhập giá (VD: 50000) hoặc Mã CK (VD: HPG)">
                <small>Nếu nhập Mã CK, giá đóng cửa gần nhất sẽ được tự động lấy.</small>
            </div>

            <div class="input-group">
                <label for="Pa"><i class="fas fa-cash-register"></i> Giá thực hiện quyền mua PHT (VNĐ):</label>
                <input type="number" id="Pa" step="100" placeholder="Giá mua ưu đãi (VD: 10000)">
            </div>

            <div class="input-group">
                <label for="phtRatioInput"><i class="fas fa-percentage"></i> Tỷ lệ PHT (Cổ phiếu được mua / Cổ phiếu sở hữu):</label>
                <input type="text" id="phtRatioInput" placeholder="VD: 100:10 hoặc 10% hoặc 10/100">
                 <small>Định dạng: Sở hữu:Được mua (100:10), Phần trăm (10%), hoặc Phân số (10/100)</small>
            </div>

            <div class="input-group">
                <label for="cashDividendInput"><i class="fas fa-hand-holding-usd"></i> Cổ tức bằng tiền mặt (VNĐ/cổ phiếu):</label>
                <input type="text" id="cashDividendInput" placeholder="VD: 2000 hoặc 20%">
                <small>Nhập số tiền (2000) hoặc Tỷ lệ % trên mệnh giá (20% = 2000đ)</small>
            </div>

             <div class="input-group">
                <label for="stockDividendRatioInput"><i class="fas fa-file-invoice-dollar"></i> Tỷ lệ Cổ tức bằng Cổ phiếu (Cổ phiếu nhận thêm / Cổ phiếu sở hữu):</label>
                <input type="text" id="stockDividendRatioInput" placeholder="VD: 100:10 hoặc 10% hoặc 10/100">
                 <small>Định dạng: Sở hữu:Nhận thêm (1000:125), Phần trăm (12,5%), hoặc Phân số (125/1000)</small>
            </div>

             <div class="button-container main-actions">
                <button class="action-button calculate-button" onclick="calculateAdjustedPrice()"> <i class="fas fa-calculator"></i> Tính Giá Điều Chỉnh
                </button>
             </div>

            <div class="result" id="resultGDKHQ">
                <p class="placeholder-text">Nhập các thông số và nhấn nút để tính giá tham chiếu điều chỉnh.</p>
            </div>
             <div id="loadingGDKHQ" style="display: none; text-align: center; margin-top: 15px;">
                 <i class="fas fa-spinner fa-spin"></i> Đang lấy giá cổ phiếu...
             </div>
        </main>
    </div>

    <div id="tab7" class="container">
        <header>
            <h1><i class="fas fa-hands-helping"></i> Hỗ trợ Nhà Đầu Tư</h1>
        </header>
        <main>
            <div class="period-tabs">
                <button class="period-tab active" onclick="showInvestorSubTab('investor-profit-loss')">Tính Lãi/Lỗ</button>
                <button class="period-tab" onclick="showInvestorSubTab('investor-avg-price')">Giá Vốn Trung Bình</button>
                <button class="period-tab" onclick="showInvestorSubTab('investor-portfolio')">Danh Mục Đầu Tư</button>
                <button class="period-tab" onclick="showInvestorSubTab('investor-target')">Lợi Nhuận Mục Tiêu</button>
            </div>

            <div id="investor-profit-loss" class="investor-sub-container active">
                <h2><i class="fas fa-balance-scale-right"></i> Tính Lãi/Lỗ & ROI</h2>
                <div class="table-wrapper">
                    <table id="profit-loss-table">
                        <thead>
                            <tr>
                                <th>Mã CK</th>
                                <th>Khối lượng</th>
                                <th>Giá mua</th>
                                <th>Giá bán / Hiện tại</th>
                                <th class="fee-header">Phí GD (%)</th>
                                <th>Lãi/Lỗ</th> 
                                <th>% ROI</th>
                                <th>Xóa</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
                <div class="button-container">
                    <button class="action-button" onclick="addProfitLossRow()"><i class="fas fa-plus"></i> Thêm lệnh</button>
                    <button class="action-button calculate-button" onclick="updateLivePricesAndCalculate()"><i class="fas fa-sync-alt"></i> Cập nhật giá hiện tại</button>
                </div>
                 <div id="profit-loss-summary" class="summary-container">
                    <div class="fee-toggle-container">
                        <span>Bao gồm phí giao dịch?</span>
                        <label class="switch">
                            <input type="checkbox" id="fee-toggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    </div>
            </div>

            <div id="investor-avg-price" class="investor-sub-container">
                <h2><i class="fas fa-chart-line"></i> Tính Giá Vốn Trung Bình</h2>
                <div class="input-group">
                    <label for="avg-price-stock-code"><i class="fas fa-tag"></i> Mã cổ phiếu:</label>
                    <input type="text" id="avg-price-stock-code" placeholder="Nhập mã (VD: HPG)">
                </div>
                <div class="table-wrapper">
                    <table id="avg-price-table">
                        <thead>
                            <tr>
                                <th>Khối lượng</th>
                                <th>Giá mua</th>
                                <th>Xóa</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
                <div class="button-container">
                    <button class="action-button" onclick="addAvgPriceRow()"><i class="fas fa-plus"></i> Thêm lệnh mua</button>
                </div>
                 <div id="avg-price-summary" class="summary-container">
                    </div>
            </div>

            <div id="investor-portfolio" class="investor-sub-container">
                 <h2><i class="fas fa-briefcase"></i> Theo Dõi Danh Mục</h2>
                 <div class="button-container">
                     <button class="action-button" onclick="exportPortfolio()"><i class="fas fa-file-excel"></i> Xuất Excel</button>
                 </div>
                 <div class="table-wrapper">
                    <table id="portfolio-table">
                        <thead>
                            <tr>
                                <th>Mã CK</th>
                                <th>Tổng KL</th>
                                <th>Giá vốn TB</th>
                                <th>Giá hiện tại</th>
                                <th>Lãi/Lỗ</th>
                                <th>ROI (%)</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
                 <div id="portfolio-summary" class="summary-container">
                    </div>
            </div>

            <div id="investor-target" class="investor-sub-container">
                <h2><i class="fas fa-bullseye"></i> Ước Tính Lợi Nhuận Mục Tiêu</h2>
                 <div class="input-group">
                    <label for="target-stock-code">Mã cổ phiếu:</label>
                    <input type="text" id="target-stock-code" placeholder="Nhập mã (VD: HPG)">
                </div>
                <div class="input-group">
                    <label for="target-buy-price">Giá mua của bạn:</label>
                    <input type="number" id="target-buy-price" placeholder="Giá bạn đã mua">
                </div>
                 <div class="input-group">
                    <label for="target-price">Giá mục tiêu:</label>
                    <input type="number" id="target-price" placeholder="Nhập giá bán mong muốn">
                </div>
                <div class="button-container">
                    <button class="action-button calculate-button" onclick="calculateTargetProfitSessions()">
                        <i class="fas fa-calculator"></i> Ước tính số phiên đạt mục tiêu
                    </button>
                </div>
                <div id="target-summary" class="summary-container">
                    </div>
            </div>
        </main>
    </div>

    <div id="tab3" class="container">
        <header>
            <h1><i class="fas fa-list-alt"></i> Niêm Yết Mới Trên HOSE</h1>
        </header>
        <main>
            <div class="period-tabs">
                <button class="period-tab active" onclick="showListingSubTab('listing-registered')">Đăng ký niêm yết</button>
                <button class="period-tab" onclick="showListingSubTab('listing-approved')">Được chấp thuận chính thức</button>
            </div>
            
            <div id="listing-registered" class="listing-sub-container active">
                <div class="table-controls">
                    <input type="text" id="search-registered" placeholder="Tìm kiếm...">
                </div>
                <div class="table-wrapper">
                    <table id="table-registered">
                        <tbody>
                            <tr>
                                <td colspan="7" class="loading-cell">
                                    <i class="fas fa-spinner fa-spin"></i> Đang tải dữ liệu...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="pagination-controls" id="pagination-registered"></div>
            </div>

            <div id="listing-approved" class="listing-sub-container">
                <div class="table-controls">
                    <input type="text" id="search-approved" placeholder="Tìm kiếm...">
                </div>
                <div class="table-wrapper">
                    <table id="table-approved">
                        <tbody>
                            <tr>
                                <td colspan="8" class="loading-cell">
                                    <i class="fas fa-spinner fa-spin"></i> Đang tải dữ liệu...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="pagination-controls" id="pagination-approved"></div>
            </div>
        </main>
    </div>

    <div id="tab4" class="container">
        <header>
            <h1><i class="fas fa-bullhorn"></i> Lịch Sự Kiện Sắp Tới</h1>
        </header>
        <main>
            <div class="period-tabs">
                <button class="period-tab active" onclick="showEventSubTab('events-general')">Tổng hợp</button>
                <button class="period-tab" onclick="showEventSubTab('events-hose')">HOSE</button>
            </div>

            <div id="events-general" class="listing-sub-container active">
                <div class="table-controls">
                    <input type="text" id="search-events-general" placeholder="Tìm kiếm...">
                </div>
                <div class="table-wrapper">
                    <table id="table-events-general">
                        <tbody>
                            <tr>
                                <td colspan="8" class="loading-cell">
                                    <i class="fas fa-spinner fa-spin"></i> Đang tải dữ liệu...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="pagination-controls" id="pagination-events-general"></div>
            </div>

            <div id="events-hose" class="listing-sub-container">
                <div class="table-controls">
                    <input type="text" id="search-events-hose" placeholder="Tìm kiếm...">
                </div>
                <div class="table-wrapper">
                    <table id="table-events-hose">
                        <tbody>
                            <tr>
                                <td colspan="8" class="loading-cell">
                                    <i class="fas fa-spinner fa-spin"></i> Đang tải dữ liệu...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="pagination-controls" id="pagination-events-hose"></div>
            </div>
        </main>
    </div>
    
    <div id="tab5" class="container">
        <header>
            <h1><i class="fas fa-paper-plane"></i> Tin tức phát hành (UBCKNN)</h1>
        </header>
        <main>
            <div class="button-container">
                <button class="action-button external-link-button" 
                        onclick="openWebUrl('https://ssc.gov.vn/webcenter/portal/ubck/pages_otherpages/tmkim?SearchInput=b%C3%A1o+c%C3%A1o+ph%C3%A1t+h%C3%A0nh')">
                    <i class="fas fa-external-link-alt"></i> Tin phát hành (Chia cổ tức)
                </button>
                <button class="action-button external-link-button" 
                        onclick="openWebUrl('https://ssc.gov.vn/webcenter/portal/ubck/pages_otherpages/tmkim?SearchInput=%C4%91%C4%83ng+k%C3%BD+ch%C3%A0o+b%C3%A1n')">
                    <i class="fas fa-external-link-alt"></i> Tin phát hành (Chào bán)
                </button>
            </div>
             <p class="placeholder-text" style="margin-top: 30px;">Nhấn vào các nút trên để mở trang tin tức tương ứng từ website của Ủy ban Chứng khoán Nhà nước trong một tab mới.</p>
        </main>
    </div>

    <div id="tab6" class="container">
        <header>
            <h1><i class="fas fa-th-large"></i> Phân tích PTKT</h1>
        </header>
        <main>
            <div class="button-container main-actions">
                 <button class="action-button external-link-button" onclick="openWebUrl('https://ptkt.dangvo.io.vn/')">
                    <i class="fas fa-external-link-alt"></i> Mở công cụ PTKT
                 </button>
                 <button class="action-button calculate-button" onclick="openFullscreenPTKT()">
                    <i class="fas fa-expand"></i> Mở Full Màn hình
                 </button>
            </div>
            <div class="iframe-container">
                <iframe id="ptkt-iframe" src="https://smoney.vodang2702.workers.dev/phan-tich-ky-thuat" frameborder="0"></iframe>
            </div>
         </main>
    </div>

    <footer>
        <p>© 2023 Stock Review by Dangvo. All rights reserved.</p>
    </footer>

    <script src="js/utils.js"></script>
    <script src="js/tab-valuation.js"></script>
    <script src="js/tab-gdkhq.js"></script>
    <script src="js/tab-investor-support.js"></script>
    <script src="js/tab-listings.js"></script>
    <script src="js/tab-events.js"></script>
    <script src="js/main.js"></script>
</body>

</html>